<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Health IA UFPB</title>

  <style>
    :root{
      --bg1:#061a2e;
      --bg2:#0b2b4a;
      --card:#0f3b66cc;
      --card2:#0b2f53cc;
      --text:#eaf4ff;
      --muted:#b9d7f3;
      --accent:#33b4ff;
      --accent2:#0ea5e9;
      --danger:#ff4d4d;
      --ok:#41d17d;
      --border:#3a76a8;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 450px at 15% 10%, #0d4b78 0%, transparent 60%),
        radial-gradient(900px 450px at 85% 20%, #0a6bb0 0%, transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    /* agora é 1 coluna (sem painel lateral) */
    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
    }

    .panel{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
      border-radius:18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      padding:18px;
      position:relative;
      overflow:hidden;
    }

    .panel::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 220px at 30% 0%, rgba(51,180,255,.18), transparent 60%);
      pointer-events:none;
    }

    header{
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:14px;
    }

    /* Logo grande no desktop */
    .logo{
      width:140px;
      height:140px;
      border-radius:22px;
      object-fit:contain;
      background:#fff;
      padding:10px;
      border:1px solid rgba(255,255,255,.25);
      box-shadow: 0 4px 12px rgba(0,0,0,.25);
      filter: contrast(1.1) brightness(1.05);
      flex: 0 0 auto;
    }

    h1{
      font-size: 26px;
      margin:0;
      letter-spacing:.2px;
      line-height:1.1;
    }

    .subtitle{
      margin-top:6px;
      font-size: 13.5px;
      color: var(--muted);
    }

    .badges{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:#dff2ff;
      background: rgba(51,180,255,.12);
      border: 1px solid rgba(51,180,255,.25);
      padding:6px 10px;
      border-radius:999px;
      width: fit-content;
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 12px 0 8px;
    }

    textarea, input{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(185,215,243,.25);
      background: rgba(3, 17, 32, .35);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
      transition: border-color .15s ease;
    }

    textarea:focus, input:focus{
      border-color: rgba(51,180,255,.65);
      box-shadow: 0 0 0 4px rgba(51,180,255,.12);
    }

    textarea{
      min-height: 120px;
      resize: vertical;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:none;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 650;
      cursor:pointer;
      color: #06203a;
      background: linear-gradient(180deg, #59c7ff, var(--accent2));
      box-shadow: 0 12px 24px rgba(14,165,233,.25);
      transition: transform .06s ease, filter .15s ease, opacity .15s ease;
    }

    .btn:hover{ filter: brightness(1.02); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .btn-ghost{
      background: rgba(255,255,255,.08);
      color: var(--text);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
      font-weight: 600;
    }

    .status{
      font-size: 12.5px;
      margin-top: 10px;
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
    }

    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(185,215,243,.55);
    }
    .dot.ok{ background: var(--ok); }
    .dot.err{ background: var(--danger); }
    .dot.busy{ background: #ffd166; }

    .resultBox{
      margin-top: 10px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(51,180,255,.25);
      background: rgba(2, 20, 38, .38);
      min-height: 150px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    footer{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(185,215,243,.8);
    }

    /* ====== RESPONSIVO ====== */
    @media (max-width: 880px){
      body{ padding: 14px; }
      .panel{ padding: 14px; border-radius: 16px; }
      header{ gap: 12px; }
      h1{ font-size: 22px; }
      .logo{ width: 110px; height: 110px; }
    }

    @media (max-width: 520px){
      header{
        flex-direction: column;
        align-items: flex-start;
      }
      .logo{
        width: 96px;
        height: 96px;
        border-radius: 18px;
      }
      .row{
        flex-direction: column;
        align-items: stretch;
      }
      .btn{
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <main class="app">
    <section class="panel">
      <header>
        <!-- IMPORTANTE: logo.jpg deve estar na mesma pasta do index.html -->
        <img class="logo" src="./logo.jpg" alt="Logo LABODIGIT / UFPB" />

        <div>
          <h1>Health IA UFPB</h1>
          <div class="subtitle">Diagnóstico baseado nos sintomas</div>

          <div class="badges">
            <div class="badge">Modelo: <b>XGBoost</b> • Acurácia: <b>83,67%</b></div>
            <div class="badge">API: <span id="apiBadge">https://healthiaufpb.onrender.com</span></div>
          </div>
        </div>
      </header>

      <label for="apiBase">URL da API</label>
      <input id="apiBase" type="text" value="https://healthiaufpb.onrender.com" />

      <label for="sintomas">Sintomas (separe por vírgula ou em linhas)</label>
      <textarea id="sintomas" placeholder="Ex.: febre, tosse, cansaço, dor de garganta"></textarea>

      <div class="row">
        <button id="btnDiagnosticar" class="btn">Gerar diagnóstico provável</button>
        <button id="btnExemplo" class="btn btn-ghost" type="button">Preencher exemplo</button>
        <button id="btnLimpar" class="btn btn-ghost" type="button">Limpar</button>
      </div>

      <div class="status" id="statusLine">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">Pronto.</span>
      </div>

      <label>Diagnóstico provável (saída)</label>
      <div class="resultBox" id="resultado">—</div>

      <footer>
        UFPB • LABODIGIT • Health IA
      </footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    const apiBase = $("apiBase");
    const apiBadge = $("apiBadge");
    const sintomas = $("sintomas");
    const resultado = $("resultado");
    const btn = $("btnDiagnosticar");
    const btnExemplo = $("btnExemplo");
    const btnLimpar = $("btnLimpar");
    const statusDot = $("statusDot");
    const statusText = $("statusText");

    function setStatus(type, text){
      statusDot.className = "dot";
      if(type === "ok") statusDot.classList.add("ok");
      if(type === "err") statusDot.classList.add("err");
      if(type === "busy") statusDot.classList.add("busy");
      statusText.textContent = text;
    }

    function normalizeSymptoms(raw){
      return raw
        .split(/[,;\n]/g)
        .map(s => s.trim())
        .filter(Boolean)
        .join(",");
    }

    apiBase.addEventListener("input", () => {
      apiBadge.textContent = apiBase.value.trim() || "(vazio)";
    });

    btnExemplo.addEventListener("click", () => {
      sintomas.value = "febre, tosse, dor de garganta\ncansaço";
      sintomas.focus();
    });

    btnLimpar.addEventListener("click", () => {
      sintomas.value = "";
      resultado.textContent = "—";
      setStatus("", "Pronto.");
    });

    btn.addEventListener("click", async () => {
      const base = (apiBase.value || "").trim().replace(/\/+$/,"");
      const raw = sintomas.value || "";
      const s = normalizeSymptoms(raw);

      if(!base){
        setStatus("err", "Informe a URL da API.");
        return;
      }
      if(!s){
        setStatus("err", "Informe pelo menos um sintoma.");
        return;
      }

      // IMPORTANTE: no Render seu endpoint deve existir assim:
      // /sintomas/predict?sintomas=...
      const url = `${base}/sintomas/predict?sintomas=${encodeURIComponent(s)}`;

      btn.disabled = true;
      resultado.textContent = "Consultando a API...";
      setStatus("busy", "Processando...");

      try{
        const res = await fetch(url, { method: "GET" });

        if(!res.ok){
          const body = await res.text().catch(() => "");
          throw new Error(`HTTP ${res.status} — ${body || "sem detalhes"}`);
        }

        const contentType = res.headers.get("content-type") || "";
        let data;
        if(contentType.includes("application/json")){
          data = await res.json();

          // Mostra top2 formatado se existir
          if (data && data.top2 && Array.isArray(data.top2)) {
            const linhas = data.top2.map((it, idx) =>
              `${idx + 1}) ${it.doenca} — ${it.prob_percent}%`
            ).join("\\n");

            resultado.textContent =
              `Diagnóstico provável: ${data.diagnostico_provavel}\\n\\n` +
              `Top 2 hipóteses:\\n${linhas}`;
          } else {
            resultado.textContent = JSON.stringify(data, null, 2);
          }

        } else {
          data = await res.text();
          resultado.textContent = data;
        }

        setStatus("ok", "Concluído.");
      }catch(err){
        console.error(err);
        resultado.textContent =
          "Erro ao consultar a API.\\n\\n" +
          "Confira se o backend está rodando e acessível na URL informada.\\n" +
          "Detalhes: " + (err?.message || err);

        setStatus("err", "Falha na requisição.");
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
<!-- deploy test: 2026-01-10  -->
